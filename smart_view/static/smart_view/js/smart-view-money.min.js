Tabulator.extendModule("format","formatters",{money_ext:function(cell,formatterParams,onRendered){let floatVal,number,integer,decimal,rgx;var add_default_class=false;if(cell.getValue()!==null){floatVal=parseFloat(cell.getValue())}else{floatVal=parseFloat(cell.getData()[formatterParams.data_if_null]);add_default_class=true}var decimalSym=formatterParams.decimal||".";var thousandSym=formatterParams.thousand||",";var symbol=formatterParams.symbol||"";var after=!!formatterParams.symbolAfter;var precision=typeof formatterParams.precision!=="undefined"?formatterParams.precision:2;if(isNaN(floatVal)){return this.emptyToSpace(this.sanitizeHTML(cell.getValue()))}number=precision!==false?floatVal.toFixed(precision):floatVal;number=String(number).split(".");integer=number[0];decimal=number.length>1?decimalSym+number[1]:"";rgx=/(\d+)(\d{3})/;while(rgx.test(integer)){integer=integer.replace(rgx,"$1"+thousandSym+"$2")}var value=after?integer+decimal+symbol:symbol+integer+decimal;if(add_default_class){return'<span class="default-value">'+value+"</span>"}else{return value}},money_conditional:function(cell,formatterParams,onRendered){var floatVal,number,integer,decimal,rgx;var add_default_class=false;var cell_value=cell.getValue();floatVal=null;for(var i=0;i<cell_value["fields"].length;i++){if(cell_value["fields"][i]!==null){floatVal=cell_value["fields"][i];break}add_default_class=true}if(floatVal===null){return""}var decimalSym=formatterParams.decimal||".";var thousandSym=formatterParams.thousand||",";var symbol=formatterParams.symbol||"";var after=!!formatterParams.symbolAfter;var precision=typeof formatterParams.precision!=="undefined"?formatterParams.precision:2;if(isNaN(floatVal)){return this.emptyToSpace(this.sanitizeHTML(cell.getValue()))}number=precision!==false?floatVal.toFixed(precision):floatVal;number=String(number).split(".");integer=number[0];decimal=number.length>1?decimalSym+number[1]:"";rgx=/(\d+)(\d{3})/;while(rgx.test(integer)){integer=integer.replace(rgx,"$1"+thousandSym+"$2")}var value=after?integer+decimal+symbol:symbol+integer+decimal;if(add_default_class){if(cell_value["flag"]){cell.getElement().classList.add("default-value");return value}else{return""}}else{if(cell_value["flag"]){cell.getElement().classList.add("set-value");return value}else{return""}}}});Tabulator.extendModule("columnCalcs","calculations",{sum_if_ext:function(values,data,calcParams){var value_column=calcParams["data"];var if_null_column=calcParams["if_null"];var test_column=calcParams["test"];var sum=0;data.forEach(function(row_data){if(row_data[test_column]){if(row_data[value_column]!==null)sum+=parseFloat(row_data[value_column]);else if(row_data[if_null_column]!==null)sum+=parseFloat(row_data[if_null_column])}});return sum},sum_conditional:function(values,data,calcParams){var value_column=calcParams["data"];var if_null_column=calcParams["if_null"];var test_column=calcParams["test"];var sum=0;values.forEach(function(cell_value_raw){var cell_value=cell_value_raw;if(cell_value["flag"]){var values=cell_value["fields"];sum+=parseFloat(values.find(el=>el!==null))}});return sum}});Tabulator.extendModule("edit","editors",{moneyCoalesceEditor:function(cell,onRendered,success,cancel,editorParams){var editor=document.createElement("input");editor.style.padding="3px";editor.style.width="100%";editor.style.boxSizing="border-box";var values_list=cell.getValue();editor.value=values_list[0];onRendered(function(){editor.focus({preventScroll:true});editor.style.height="100%"});function successFunc(){values_list[0]=parseFloat(editor.value);console.log("Success:",editor.value,values_list);success(JSON.stringify(values_list))}editor.addEventListener("change",successFunc);editor.addEventListener("blur",successFunc);return editor},moneyConditionnalEditor:function(cell,onRendered,success,cancel,editorParams){var editor=document.createElement("input");editor.style.padding="3px";editor.style.width="100%";editor.style.boxSizing="border-box";var cell_value=cell.getValue();var values_list=cell_value["fields"];var flag_value=cell_value["flag"];editor.value=values_list[0];onRendered(function(){editor.focus({preventScroll:true});editor.style.height="100%"});function successFunc(){values_list[0]=parseFloat(editor.value);success(JSON.stringify({flag:flag_value,fields:values_list}))}editor.addEventListener("change",successFunc);editor.addEventListener("blur",successFunc);return editor}});Tabulator.extendModule("sort","sorters",{moneySorter:function(a,b,aRow,bRow,column,dir,sorterParams){return a-b},moneyConditionalSorter:function(a,b,aRow,bRow,column,dir,sorterParams){let va=0;let vb=0;if(a.flag===true){for(var i=0;i<a.fields.length;i++){if(a.fields[i]!==null){va=a.fields[i];break}}}if(b.flag===true){for(var i=0;i<b.fields.length;i++){if(b.fields[i]!==null){vb=b.fields[i];break}}}return va-vb}});